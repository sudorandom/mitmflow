edition = "2023";

package mitmflow.v1;

import "mitmproxygrpc/v1/service.proto";

service Service {
  rpc StreamFlows(StreamFlowsRequest) returns (stream StreamFlowsResponse) {}
  rpc UpdateFlow(UpdateFlowRequest) returns (UpdateFlowResponse) {}
  rpc DeleteFlows(DeleteFlowsRequest) returns (DeleteFlowsResponse) {}
}

message StreamFlowsRequest {}

message StreamFlowsResponse {
  Flow flow = 1;
}

message UpdateFlowRequest {
  string flow_id = 1;
  bool pinned = 2;
}

message UpdateFlowResponse {
  Flow flow = 1;
}

message DeleteFlowsRequest {
  repeated string flow_ids = 1;
  bool all = 2;
}

message DeleteFlowsResponse {
  int64 count = 1;
}

message Flow {
  oneof flow {
    mitmproxy.v1.HTTPFlow http_flow = 1;
    mitmproxy.v1.TCPFlow tcp_flow = 2;
    mitmproxy.v1.UDPFlow udp_flow = 3;
    mitmproxy.v1.DNSFlow dns_flow = 4;
  }
  HTTPFlowExtra http_flow_extra = 5;
  bool pinned = 6;
}

message HTTPFlowExtra {
  MessageDetails request = 1;
  MessageDetails response = 2;
}

message MessageDetails {
  repeated string textual_frames = 1;
  string effective_content_type = 2;
}
